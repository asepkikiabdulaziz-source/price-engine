<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Price Engine - Aplikasi Manajemen Harga">
    <title>Nabaticuan - Price Engine</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'%3E%3Crect width='192' height='192' fill='%231e3a8a'/%3E%3Ctext x='50%25' y='50%25' font-size='80' fill='white' text-anchor='middle' dominant-baseline='middle'%3EN%3C/text%3E%3C/svg%3E" type="image/svg+xml">
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
</head>
<body>
    <div class="container">
        <!-- Login Section -->
        <div id="login-section" class="login-section">
            <div class="login-card">
                <h1>Nabaticuan</h1>
                <form id="login-form">
                    <div class="form-group">
                        <label for="region">Region</label>
                        <select id="region" name="region" required>
                            <option value="">Pilih Region</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="depo">Depo</label>
                        <select id="depo" name="depo" required disabled>
                            <option value="">Pilih Depo</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="kode-sales">Kode Sales</label>
                        <input type="text" id="kode-sales" name="kode-sales" placeholder="Masukkan Kode Sales" required>
                    </div>
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" id="password" name="password" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Login</button>
                </form>
                <div id="login-error" class="error-message"></div>
                <div style="margin-top: 15px; text-align: center;">
                    <button id="refresh-page-btn" class="btn btn-secondary" style="font-size: 0.9em; padding: 8px 16px;">
                        üîÑ Refresh Halaman
                    </button>
                </div>
            </div>
        </div>

        <!-- Main App Section -->
        <div id="app-section" class="app-section" style="display: none;">
            <!-- Welcome Message (Sticky) -->
            <div id="welcome-message" class="welcome-message" style="display: none;">
                <div class="welcome-message-content">
                    <div class="welcome-message-header">
                        <span class="welcome-icon">üëã</span>
                        <span class="welcome-title">Selamat Datang</span>
                        <button id="close-welcome-btn" class="close-welcome-btn" aria-label="Close">√ó</button>
                    </div>
                    <div class="welcome-message-body" id="welcome-message-body">
                        <div class="version-info-loading">Memuat informasi versi...</div>
                    </div>
                </div>
            </div>
            <header class="header">
                <div class="header-top">
                    <div class="header-left">
                        <h1>Nabaticuan</h1>
                    </div>
                    <div class="header-user-info" id="header-user-info" style="display: none;">
                        <div class="user-info-simple" id="user-info-simple">-</div>
                        <div class="header-right">
                            <button id="logout-btn" class="btn btn-secondary">Logout</button>
                        </div>
                    </div>
                </div>
                <!-- Store Type Selection (Inside header, always visible) -->
                <div class="header-controls" id="header-controls" style="display: none;">
                    <div class="store-type-card">
                        <select id="store-type" name="store-type" class="store-type-select">
                            <option value="grosir" selected>Grosir</option>
                            <option value="retail">Retail</option>
                        </select>
                        <select id="loyalty-class" name="loyalty-class" class="loyalty-class-select">
                            <option value="">-- Pilih Kelas --</option>
                        </select>
                    </div>
                </div>
            </header>
            <main class="main-content">

                <!-- Main Layout: Tab Content + Cart Sidebar -->
                <div class="main-layout">
                    <!-- Tab Content -->
                    <div class="tab-content-wrapper">
                        <div class="tab-content">
                            <!-- Tab 1: Simulasi Order -->
                            <div class="tab-pane active" id="tab-simulasi">
                                <div class="product-column">
                                    <div class="card products-card">
                                        <h2>Daftar Produk</h2>
                                        <div class="product-groups" id="product-groups">
                                            <div class="loading-message">Memuat data produk...</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Tab 2: Tabel Promosi -->
                            <div class="tab-pane" id="tab-promosi">
                                <div class="promosi-section">
                                    <div class="card">
                                        <h2>Tabel Promosi</h2>
                                        <div class="promo-table-container">
                                            <p>Daftar promosi akan ditampilkan di sini</p>
                                            <!-- Tabel promosi akan di-load dari database -->
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Tab 3: KPI -->
                            <div class="tab-pane" id="tab-kpi">
                                <div class="kpi-section">
                                    <div class="card">
                                        <h2>KPI</h2>
                                        <div class="kpi-content">
                                            <p>Dashboard KPI akan ditampilkan di sini</p>
                                            <!-- KPI metrics akan di-load dari database -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Order Cart Sidebar (Desktop: Sticky, Mobile: Fixed Modal) -->
                    <aside class="cart-sidebar" id="cart-sidebar">
                        <button id="close-cart-btn" class="close-cart">&times;</button>
                        <h2>Keranjang</h2>
                        <div class="cart-items" id="cart-items">
                            <div class="empty-cart">Belum ada produk dalam keranjang</div>
                        </div>

                        <!-- Calculation Result -->
                        <div class="calculation-section">
                            <h2>Hasil Perhitungan</h2>
                            <div class="calculation-details" id="calculation-details">
                                <div class="calc-row">
                                    <span>Total Gross:</span>
                                    <span class="amount" id="total-base-price">Rp 0</span>
                                </div>
                                <div class="calc-row">
                                    <span>Diskon Reguler:</span>
                                    <span class="amount discount" id="principal-discount">- Rp 0</span>
                                </div>
                                <div class="calc-row">
                                    <span>Pot. Strata:</span>
                                    <span class="amount discount" id="group-discount">- Rp 0</span>
                                </div>
                                <div class="calc-row">
                                    <span>Program Kawin:</span>
                                    <span class="amount discount" id="bundle-discount">- Rp 0</span>
                                </div>
                                <div class="calc-row">
                                    <span>Promo Gratis Produk:</span>
                                    <span class="amount discount" id="free-product-discount">- Rp 0</span>
                                </div>
                                <div class="calc-row">
                                    <span>Diskon Invoice:</span>
                                    <span class="amount discount" id="invoice-discount">- Rp 0</span>
                                </div>
                                <div class="calc-row total-row">
                                    <span><strong>Total Harga Nett:</strong></span>
                                    <span class="amount total" id="total-nett-price"><strong>Rp 0</strong></span>
                                </div>
                                <div class="calc-row payment-row">
                                    <span>Metode Pembayaran:</span>
                                    <select id="payment-method" class="payment-select">
                                        <option value="COD" selected>COD</option>
                                        <option value="CBD">CBD</option>
                                    </select>
                                </div>
                                <div class="calc-row voucher-row">
                                    <span>Voucher:</span>
                                    <input type="tel" id="voucher-input" class="voucher-input" placeholder="Input voucher...">
                                </div>
                                <div class="calc-row final-total-row">
                                    <span><strong>Final Tagihan:</strong></span>
                                    <span class="amount total" id="final-tagihan"><strong>Rp 0</strong></span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Cart Actions -->
                        <div class="cart-actions">
                            <button id="cart-reset-button" class="btn btn-danger btn-block">üóëÔ∏è Reset</button>
                            <button id="cart-lihat-faktur-button" class="btn btn-primary btn-block">üßæ Lihat Faktur</button>
                        </div>
                    </aside>
                </div>

                <!-- Summary Bar (Mobile Only) -->
                <div id="summary-bar" class="summary-bar">
                    <div class="summary-bar-content">
                        <div class="summary-bar-main">
                            <div>
                                <span class="summary-bar-label">Total Tagihan (Nett)</span>
                                <div id="summary-bar-total" class="summary-bar-total">Rp 0</div>
                            </div>
                            <span class="summary-bar-arrow">‚ñ≤</span>
                        </div>
                    </div>
                </div>

                <!-- Bottom Navigation Tabs -->
                <nav class="bottom-nav">
                    <button class="nav-tab active" data-tab="tab-simulasi">
                        <span class="nav-icon">üõí</span>
                        <span class="nav-label">Order</span>
                    </button>
                    <button class="nav-tab" data-tab="tab-promosi">
                        <span class="nav-icon">üéÅ</span>
                        <span class="nav-label">Promosi</span>
                    </button>
                    <button class="nav-tab" data-tab="tab-kpi">
                        <span class="nav-icon">üìä</span>
                        <span class="nav-label">KPI</span>
                    </button>
                </nav>
            </main>
        </div>
    </div>

    <script src="js/store.js"></script>
    <script type="module" src="app.js"></script>
    
    <script>
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(registration => {
                        console.log('Service Worker registered successfully:', registration.scope);
                    })
                    .catch(error => {
                        console.warn('Service Worker registration failed:', error);
                        // Don't show error to user - app works without service worker
                    });
            });
        }
    </script>

    <!-- Modal Detail Harga -->
    <div id="price-detail-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal" id="close-price-modal">&times;</span>
            <div class="modal-header-success">
                <h3 id="price-modal-title">Rincian Harga</h3>
            </div>
            <div id="price-modal-details">
                <!-- Detail harga akan diisi oleh JavaScript -->
            </div>
            <button id="price-modal-close-btn" class="btn btn-secondary" style="margin-top: 20px; width: 100%;">Tutup</button>
        </div>
    </div>

    <!-- Promo Info Modal -->
    <div id="promo-info-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal" id="close-promo-modal">&times;</span>
            <div class="modal-header-success">
                <h3 id="promo-modal-title">Info Promo</h3>
            </div>
            <div id="promo-modal-details">
                <!-- Detail promo akan diisi oleh JavaScript -->
            </div>
            <button id="promo-modal-close-btn" class="btn btn-secondary" style="margin-top: 20px; width: 100%;">Tutup</button>
        </div>
    </div>
</body>
</html>

